# Yandex cloud function telegram ai bot

## Особенности
1. Для работы speechkit-sdk нужен ffmpeg, в окружении с нужной версией python работает только старая версия https://github.com/BtbN/FFmpeg-Builds/releases/tag/autobuild-2023-10-31-13-06
нужно скачать ffmpeg-N-112560-g2c3d2a0245-linux64-gplб распаковать и взять из папки bin файлы ffmpeg и ffprobe и положить их в папку src
2. В последней версии python(3.12) в среде выполнения yandex cloud function не ставится нужная версия, а именно 13.15, поэтому следует использовать самую свежуб совместимую с этой версией библиотеки. Создать функицю со средой выполнения отличной от последней можно только через API Yandex cloud или terraform
3. Обращения к моделям платное, так что необходимо создать платежный аккаунт и закинуть немного денег в облако. Остальное(функции, логирование, бакеты) укладывается в free tier


## Prerequisite

1. создать аккаунт в yandex cloud
2. создать там каталог
3. ID облака и каталога положить в соотвествующие переменные (`cloud_id` и `folder_id`)
4. token для телеграм бота положить в переменную `bot_token`
5. создать сервис аккаунт для terraform с правами admin и создать Авторизованный ключ
6. ключ скачать и положить в папку проекта
7. создать статические ключи доступа для service account terraform, значения ключа и секрета положить в переименные окружения `AWS_ACCESS_KEY_ID` и `AWS_SECRET_ACCESS_KEY`
8. создать бакет для хранения стейта с именем `terraform-state-bucket_<folderID>` где folderID - ID вашего каталога в клауде, так как имена бакетов должны быть уникальными
9. инициализировать терраформ командой `terraform init -backend-config="bucket=terraform-state-bucket_<folderID>"`

